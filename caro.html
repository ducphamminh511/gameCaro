<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="/d3js/d3.v4.min.js"></script>
    <script src="/js/jquery-3.2.0.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <title>Document</title>
</head>
<body>
    <div>
        <li><a id="white" href="#"> Chọn màu trắng</a></li>
        <li><a id="black" href="#"> Chọn màu đen</a></li>
    </div>
    <script>
        var socket = io('/');
        $(document).ready(function(){
            
            $('#white').click(function(){
                socket.emit('chonmau',{color:'white'});
            });
            $('#black').click(function(){
                socket.emit('chonmau',{color:'black'});
            })
        });
        var turn ;
       //vẽ bàn cờ
       var width = 600;
       var height = 600; 
       var size = d3.range(100);
       var id = '0'; //đã vẽ rồi
       socket.on('confirmColor', function(c){
           if(c.color == 'black')
            turn = true;
           else
            turn = false
       })
       

       
       var svgContainer =  d3.select('body').append('svg').attr('width', width).attr('height', height);
       //hết đoạn vẽ bàn cờ
       //---------------------
       //Đoàn này vẽ ô cờ
       var rectangle = svgContainer.selectAll('rect').data(size).enter().append('rect')
                                    .attr('x',function(d){
                                        return (d%10)*52 + 10;
                                    })
                                    .attr('y',function(d){
                                        return (Math.floor(d/10)*52 + 10);
                                    }).attr('width',50).attr('height',50).attr('fill','#e6b800').attr('id',id);
       var event = rectangle.on('mouseover',function(){
           d3.select(this).attr('fill','#ffff4d');
       }).on('mouseout', function(){
           d3.select(this).attr('fill','#e6b800');
       }).on('click', function(){
            var x = this.x.animVal.value ;
            var y = this.y.baseVal.value ;
            if(turn)
            {
                d3.select('body').selectAll('svg').append('circle').attr('cx', x+25).attr('cy', y+25).attr('r', 20).attr('fill','black');
                id = '1';
                d3.select(this).attr('id',id);    

            }
            else if(!turn)
            {
                d3.select('body').selectAll('svg').append('circle').attr('cx', x+25).attr('cy', y+25).attr('r', 20).attr('fill','white');
                id = '1';
                d3.select(this).attr('id',id);   
            }
            socket.emit('clientClick',{x:x,y:y,turn:turn,id:id});  
       });
       var color='';
        //Nghe trả lời từ server
       socket.on('serverNotify', function(data){
          
            if(data.turn == true)
            {
                color = 'black';
                drawO(data.x,data.y,data.id,color);
                turn = false;
            }
            else
            {
                color = 'white';
                drawO(data.x,data.y,data.id,color);
                turn = true;
            }
       })
       function drawO(x,y,id,color){
            //vẽ O
            d3.select('body').selectAll('svg').append('circle').attr('cx', x+25).attr('cy', y+25).attr('r', 20).attr('fill',color);
            id = '1';
            d3.select(this).attr('id',id);
       };
    </script>
    
</body>
</html>