<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="/d3js/d3.v4.min.js"></script>
    <script src="/js/jquery-3.2.0.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <title>Document</title>
</head>
<body>
    <script>
        var socket = io('/');
        $(document).ready(function(){
            
        });
        var turn = true;
       socket.on('serverNotify', function(data){
            draw(data.x,data.y,data.turn,data.id);
            id = '0';
            if(turn)
                turn = false;
            else    
                turn = true;
       })
       var width = 600;
       var height = 600; 
       var size = d3.range(100);
       var id = '0'; //đã vẽ rồi
       
       var svgContainer =  d3.select('body').append('svg').attr('width', width).attr('height', height);
       var rectangle = svgContainer.selectAll('rect').data(size).enter().append('rect')
       .attr('x',function(d){
           return (d%10)*52 + 10;
       })
       .attr('y',function(d){
           return (Math.floor(d/10)*52 + 10);
       }).attr('width',50).attr('height',50).attr('fill','#e6b800').attr('id',id);
       var event = rectangle.on('mouseover',function(){
           d3.select(this).attr('fill','#ffff4d');
       }).on('mouseout', function(){
           d3.select(this).attr('fill','#e6b800');
       }).on('click', function(){
            
            var x = this.x.animVal.value ;
            var y = this.y.baseVal.value ;
            if(turn && this.id == '0' ){
                //vẽ O
                d3.select('body').selectAll('svg').append('circle').attr('cx', x+25).attr('cy', y+25).attr('r', 20).attr('fill','#0066ff');
                // turn =false;
                id = '1';
                d3.select(this).attr('id',id);

            }
                
            else if(!turn && this.id == '0')
            {
                //vẽ X
                // d3.select('body').selectAll('svg').append('circle').attr('cx', x +25).attr('cy', y+25).attr('r', 25).attr('fill','black');
                d3.select('body').selectAll('svg').append('line')
                .attr('x1', x+10).attr('y1', y+10).attr('x2', x+40).attr('y2', y+40).attr('stroke','#ff3300').attr('stroke-width',5);
                d3.select('body').selectAll('svg').append('line')
                .attr('x1', x+40).attr('y1', y+10).attr('x2', x+10).attr('y2', y+40).attr('stroke','#ff3300').attr('stroke-width',5);
                 //turn = true;
                 id = '1'
                 d3.select(this).attr('id',id);
            }
            socket.emit('clientClick',{x:x,y:y,turn:turn,id:id});
                
       });
       function draw(x,y,turn,id){
           if(turn && this.id == '0' ){
                //vẽ O
                d3.select('body').selectAll('svg').append('circle').attr('cx', x+25).attr('cy', y+25).attr('r', 20).attr('fill','#0066ff');
                // turn =false;
                id = '1';
                d3.select(this).attr('id',id);

            }
                
            else if(!turn && this.id == '0')
            {
                //vẽ X
                // d3.select('body').selectAll('svg').append('circle').attr('cx', x +25).attr('cy', y+25).attr('r', 25).attr('fill','black');
                d3.select('body').selectAll('svg').append('line')
                .attr('x1', x+10).attr('y1', y+10).attr('x2', x+40).attr('y2', y+40).attr('stroke','#ff3300').attr('stroke-width',5);
                d3.select('body').selectAll('svg').append('line')
                .attr('x1', x+40).attr('y1', y+10).attr('x2', x+10).attr('y2', y+40).attr('stroke','#ff3300').attr('stroke-width',5);
                //  turn = true;
                 id = '1'
                 d3.select(this).attr('id',id);
            }
            socket.emit('clientClick',{x:x,y:y,turn:turn,id:id});
       }

    </script>
    
</body>
</html>